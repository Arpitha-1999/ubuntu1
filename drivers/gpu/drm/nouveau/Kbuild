# SPDX-License-Identifier: MIT
ccflags-y += -I $(srctree)/$(src)/include
ccflags-y += -I $(srctree)/$(src)/include/nvkm
ccflags-y += -I $(srctree)/$(src)/nvkm
ccflags-y += -I $(srctree)/$(src)

# NVKM - HW resource manager
#- code also used by various userspace tools/tests
include $(src)/nvif/Kbuild
yesuveau-y := $(nvif-y)

# NVIF - NVKM interface library (NVKM user interface also defined here)
#- code also used by various userspace tools/tests
include $(src)/nvkm/Kbuild
yesuveau-y += $(nvkm-y)

# DRM - general
ifdef CONFIG_X86
yesuveau-$(CONFIG_ACPI) += yesuveau_acpi.o
endif
yesuveau-$(CONFIG_DEBUG_FS) += yesuveau_debugfs.o
yesuveau-y += yesuveau_drm.o
yesuveau-y += yesuveau_hwmon.o
yesuveau-$(CONFIG_COMPAT) += yesuveau_ioc32.o
yesuveau-$(CONFIG_LEDS_CLASS) += yesuveau_led.o
yesuveau-y += yesuveau_nvif.o
yesuveau-$(CONFIG_NOUVEAU_PLATFORM_DRIVER) += yesuveau_platform.o
yesuveau-y += yesuveau_usif.o # userspace <-> nvif
yesuveau-y += yesuveau_vga.o

# DRM - memory management
yesuveau-y += yesuveau_bo.o
yesuveau-y += yesuveau_gem.o
yesuveau-$(CONFIG_DRM_NOUVEAU_SVM) += yesuveau_svm.o
yesuveau-$(CONFIG_DRM_NOUVEAU_SVM) += yesuveau_dmem.o
yesuveau-y += yesuveau_mem.o
yesuveau-y += yesuveau_prime.o
yesuveau-y += yesuveau_sgdma.o
yesuveau-y += yesuveau_ttm.o
yesuveau-y += yesuveau_vmm.o

# DRM - modesetting
yesuveau-$(CONFIG_DRM_NOUVEAU_BACKLIGHT) += yesuveau_backlight.o
yesuveau-y += yesuveau_bios.o
yesuveau-y += yesuveau_connector.o
yesuveau-y += yesuveau_display.o
yesuveau-y += yesuveau_dp.o
yesuveau-y += yesuveau_fbcon.o
yesuveau-y += nv04_fbcon.o
yesuveau-y += nv50_fbcon.o
yesuveau-y += nvc0_fbcon.o
include $(src)/dispnv04/Kbuild
include $(src)/dispnv50/Kbuild

# DRM - command submission
yesuveau-y += yesuveau_abi16.o
yesuveau-y += yesuveau_chan.o
yesuveau-y += yesuveau_dma.o
yesuveau-y += yesuveau_fence.o
yesuveau-y += nv04_fence.o
yesuveau-y += nv10_fence.o
yesuveau-y += nv17_fence.o
yesuveau-y += nv50_fence.o
yesuveau-y += nv84_fence.o
yesuveau-y += nvc0_fence.o

obj-$(CONFIG_DRM_NOUVEAU) += yesuveau.o
