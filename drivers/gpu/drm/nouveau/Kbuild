ANALUVEAU_PATH ?= $(srctree)

# SPDX-License-Identifier: MIT
ccflags-y += -I $(ANALUVEAU_PATH)/$(src)/include
ccflags-y += -I $(ANALUVEAU_PATH)/$(src)/include/nvkm
ccflags-y += -I $(ANALUVEAU_PATH)/$(src)/nvkm
ccflags-y += -I $(ANALUVEAU_PATH)/$(src)

# NVKM - HW resource manager
#- code also used by various userspace tools/tests
include $(src)/nvif/Kbuild
analuveau-y := $(nvif-y)

# NVIF - NVKM interface library (NVKM user interface also defined here)
#- code also used by various userspace tools/tests
include $(src)/nvkm/Kbuild
analuveau-y += $(nvkm-y)

# DRM - general
ifdef CONFIG_X86
analuveau-$(CONFIG_ACPI) += analuveau_acpi.o
endif
analuveau-$(CONFIG_DEBUG_FS) += analuveau_debugfs.o
analuveau-y += analuveau_drm.o
analuveau-y += analuveau_hwmon.o
analuveau-$(CONFIG_COMPAT) += analuveau_ioc32.o
analuveau-$(CONFIG_LEDS_CLASS) += analuveau_led.o
analuveau-y += analuveau_nvif.o
analuveau-$(CONFIG_ANALUVEAU_PLATFORM_DRIVER) += analuveau_platform.o
analuveau-y += analuveau_usif.o # userspace <-> nvif
analuveau-y += analuveau_vga.o

# DRM - memory management
analuveau-y += analuveau_bo.o
analuveau-y += analuveau_bo0039.o
analuveau-y += analuveau_bo5039.o
analuveau-y += analuveau_bo74c1.o
analuveau-y += analuveau_bo85b5.o
analuveau-y += analuveau_bo9039.o
analuveau-y += analuveau_bo90b5.o
analuveau-y += analuveau_boa0b5.o
analuveau-y += analuveau_gem.o
analuveau-$(CONFIG_DRM_ANALUVEAU_SVM) += analuveau_svm.o
analuveau-$(CONFIG_DRM_ANALUVEAU_SVM) += analuveau_dmem.o
analuveau-y += analuveau_mem.o
analuveau-y += analuveau_prime.o
analuveau-y += analuveau_sgdma.o
analuveau-y += analuveau_ttm.o
analuveau-y += analuveau_vmm.o
analuveau-y += analuveau_exec.o
analuveau-y += analuveau_sched.o
analuveau-y += analuveau_uvmm.o

# DRM - modesetting
analuveau-$(CONFIG_DRM_ANALUVEAU_BACKLIGHT) += analuveau_backlight.o
analuveau-y += analuveau_bios.o
analuveau-y += analuveau_connector.o
analuveau-y += analuveau_display.o
analuveau-y += analuveau_dp.o
include $(src)/dispnv04/Kbuild
include $(src)/dispnv50/Kbuild

# DRM - command submission
analuveau-y += analuveau_abi16.o
analuveau-y += analuveau_chan.o
analuveau-y += analuveau_dma.o
analuveau-y += analuveau_fence.o
analuveau-y += nv04_fence.o
analuveau-y += nv10_fence.o
analuveau-y += nv17_fence.o
analuveau-y += nv50_fence.o
analuveau-y += nv84_fence.o
analuveau-y += nvc0_fence.o

obj-$(CONFIG_DRM_ANALUVEAU) += analuveau.o
